<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Layout-Preserving Sync Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .sync-indicator {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Header -->
    <header class="bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 py-6">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold">Layout-Preserving Sync System</h1>
                    <p class="text-blue-100 mt-1">Sync data without changing your layouts</p>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="importLayoutBtn" class="bg-green-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-700">
                        Import Your Layout
                    </button>
                    <button id="syncDataBtn" class="bg-white text-blue-600 px-4 py-2 rounded-lg font-medium hover:bg-gray-100">
                        Sync Data Only
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- Layout Import Section -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-xl font-bold text-gray-800 mb-4">How to Use Your Existing Layouts</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="bg-blue-50 rounded-lg p-4">
                    <div class="text-2xl mb-2">üìã</div>
                    <h3 class="font-semibold text-blue-800 mb-2">Step 1: Prepare Your Layout</h3>
                    <p class="text-sm text-blue-700">Add data-sync attributes to elements you want to update with live data</p>
                </div>
                <div class="bg-green-50 rounded-lg p-4">
                    <div class="text-2xl mb-2">üîó</div>
                    <h3 class="font-semibold text-green-800 mb-2">Step 2: Import Layout</h3>
                    <p class="text-sm text-green-700">Upload your HTML file or paste your code - we'll preserve all styling</p>
                </div>
                <div class="bg-purple-50 rounded-lg p-4">
                    <div class="text-2xl mb-2">‚ö°</div>
                    <h3 class="font-semibold text-purple-800 mb-2">Step 3: Sync Data</h3>
                    <p class="text-sm text-purple-700">Only the data content updates - your layout stays exactly the same</p>
                </div>
            </div>

            <!-- Layout Import Interface -->
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6">
                <div class="text-center mb-4">
                    <div class="text-4xl mb-2">üìÅ</div>
                    <h3 class="text-lg font-semibold text-gray-800">Import Your Dashboard Layout</h3>
                    <p class="text-gray-600">Choose how you want to provide your existing layout</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- File Upload -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-medium text-gray-800 mb-2">Upload HTML File</h4>
                        <input type="file" id="layoutFileInput" accept=".html" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 mb-2">
                        <button id="uploadLayoutBtn" class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700">
                            Upload Layout
                        </button>
                    </div>

                    <!-- Code Paste -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-medium text-gray-800 mb-2">Paste HTML Code</h4>
                        <textarea id="layoutCodeInput" placeholder="Paste your HTML code here..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 mb-2 h-20 resize-none"></textarea>
                        <button id="pasteLayoutBtn" class="w-full px-4 py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700">
                            Use This Layout
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Sync Attributes Guide -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Data Sync Attributes Guide</h2>
            <p class="text-gray-600 mb-4">Add these attributes to your HTML elements to make them sync with live data:</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="font-semibold text-gray-800 mb-3">Available Data Attributes</h3>
                    <div class="space-y-2 text-sm">
                        <div class="bg-gray-50 p-2 rounded">
                            <code class="text-blue-600">data-sync="total-sales"</code>
                            <span class="text-gray-600 ml-2">- Total franchise sales</span>
                        </div>
                        <div class="bg-gray-50 p-2 rounded">
                            <code class="text-blue-600">data-sync="avg-ticket"</code>
                            <span class="text-gray-600 ml-2">- Average ticket value</span>
                        </div>
                        <div class="bg-gray-50 p-2 rounded">
                            <code class="text-blue-600">data-sync="conversion-rate"</code>
                            <span class="text-gray-600 ml-2">- Overall conversion rate</span>
                        </div>
                        <div class="bg-gray-50 p-2 rounded">
                            <code class="text-blue-600">data-sync="designer-count"</code>
                            <span class="text-gray-600 ml-2">- Total active designers</span>
                        </div>
                        <div class="bg-gray-50 p-2 rounded">
                            <code class="text-blue-600">data-sync="franchise-list"</code>
                            <span class="text-gray-600 ml-2">- Franchise performance table</span>
                        </div>
                        <div class="bg-gray-50 p-2 rounded">
                            <code class="text-blue-600">data-sync="top-performers"</code>
                            <span class="text-gray-600 ml-2">- Top performing designers</span>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 class="font-semibold text-gray-800 mb-3">Example Usage</h3>
                    <div class="bg-gray-900 text-green-400 p-4 rounded-lg text-sm font-mono">
                        <div class="text-gray-500"><!-- Your existing styling --></div>
                        <div>&lt;div class="my-sales-card"&gt;</div>
                        <div class="ml-4">&lt;h3&gt;Total Sales&lt;/h3&gt;</div>
                        <div class="ml-4">&lt;p <span class="text-yellow-400">data-sync="total-sales"</span>&gt;</div>
                        <div class="ml-8">$0</div>
                        <div class="ml-4">&lt;/p&gt;</div>
                        <div>&lt;/div&gt;</div>
                        <br>
                        <div class="text-gray-500"><!-- Table example --></div>
                        <div>&lt;tbody <span class="text-yellow-400">data-sync="franchise-list"</span>&gt;</div>
                        <div class="ml-4">&lt;!-- Rows auto-generated --&gt;</div>
                        <div>&lt;/tbody&gt;</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Current Layout Preview -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800">Current Layout Preview</h2>
                <div class="flex items-center space-x-2">
                    <span id="layoutStatus" class="text-sm bg-gray-200 text-gray-700 px-3 py-1 rounded-full">No layout loaded</span>
                    <button id="clearLayoutBtn" class="px-4 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 text-sm">
                        Clear Layout
                    </button>
                </div>
            </div>
            
            <!-- Layout will be rendered here -->
            <div id="layoutPreview" class="border border-gray-200 rounded-lg min-h-64 bg-gray-50 flex items-center justify-center">
                <div class="text-center text-gray-500">
                    <div class="text-4xl mb-2">üé®</div>
                    <p>Your imported layout will appear here</p>
                    <p class="text-sm">Upload or paste your HTML to get started</p>
                </div>
            </div>
        </div>

        <!-- Sync Configuration -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Sync Configuration</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <h3 class="font-semibold text-gray-800 mb-2">Sync Frequency</h3>
                    <select id="syncFrequency" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="manual">Manual sync only</option>
                        <option value="30">Every 30 seconds</option>
                        <option value="60" selected>Every minute</option>
                        <option value="300">Every 5 minutes</option>
                        <option value="900">Every 15 minutes</option>
                    </select>
                </div>
                
                <div>
                    <h3 class="font-semibold text-gray-800 mb-2">Data Sources</h3>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="checkbox" checked class="mr-2">
                            <span class="text-sm">Franchise V15 Dashboards</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" checked class="mr-2">
                            <span class="text-sm">Designer Performance Data</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" checked class="mr-2">
                            <span class="text-sm">Sales Metrics</span>
                        </label>
                    </div>
                </div>
                
                <div>
                    <h3 class="font-semibold text-gray-800 mb-2">Sync Status</h3>
                    <div class="space-y-2">
                        <div class="flex items-center">
                            <div id="syncIndicator" class="w-3 h-3 bg-gray-400 rounded-full mr-2"></div>
                            <span id="syncStatusText" class="text-sm text-gray-600">Ready to sync</span>
                        </div>
                        <div class="text-xs text-gray-500" id="lastSyncTime">Never synced</div>
                        <button id="testSyncBtn" class="w-full px-3 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 text-sm">
                            Test Sync
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Sample Data for Testing -->
    <script>
        // Sample franchise data that would come from your V15 dashboards
        const sampleData = {
            totalSales: 2847500,
            avgTicket: 1547,
            conversionRate: 58.3,
            designerCount: 47,
            franchises: [
                { name: "Downtown Kitchen Studio", location: "Chicago, IL", sales: 425000, goal: 350000, performance: 121.4 },
                { name: "North Shore Gallery", location: "Evanston, IL", sales: 465000, goal: 400000, performance: 116.3 },
                { name: "Suburban Design Center", location: "Naperville, IL", sales: 380000, goal: 320000, performance: 118.8 }
            ],
            topPerformers: [
                { name: "Sarah Johnson", franchise: "Downtown Kitchen Studio", sales: 85000 },
                { name: "Alexandra Stone", franchise: "North Shore Gallery", sales: 95000 },
                { name: "Jennifer Adams", franchise: "Suburban Design Center", sales: 92000 }
            ]
        };

        let currentLayout = null;
        let syncInterval = null;
        let isAutoSyncing = false;

        // Layout management functions
        function loadLayoutFromFile() {
            const fileInput = document.getElementById('layoutFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select an HTML file first');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const htmlContent = e.target.result;
                loadLayout(htmlContent, file.name);
            };
            reader.readAsText(file);
        }

        function loadLayoutFromCode() {
            const codeInput = document.getElementById('layoutCodeInput');
            const htmlContent = codeInput.value.trim();
            
            if (!htmlContent) {
                alert('Please paste your HTML code first');
                return;
            }

            loadLayout(htmlContent, 'Pasted Code');
        }

        function loadLayout(htmlContent, sourceName) {
            try {
                // Store the original layout
                currentLayout = htmlContent;
                
                // Create a safe preview (remove any script tags for security)
                const safeHtml = htmlContent.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '');
                
                // Display in preview
                const preview = document.getElementById('layoutPreview');
                preview.innerHTML = safeHtml;
                
                // Update status
                document.getElementById('layoutStatus').textContent = `Loaded: ${sourceName}`;
                document.getElementById('layoutStatus').className = 'text-sm bg-green-200 text-green-700 px-3 py-1 rounded-full';
                
                // Scan for sync attributes
                const syncElements = preview.querySelectorAll('[data-sync]');
                console.log(`Found ${syncElements.length} elements with data-sync attributes:`, 
                    Array.from(syncElements).map(el => el.getAttribute('data-sync')));
                
                alert(`Layout loaded successfully!\nFound ${syncElements.length} elements ready for data sync.\n\nYour layout structure and styling are preserved exactly as you created them.`);
                
                // Clear inputs
                document.getElementById('layoutFileInput').value = '';
                document.getElementById('layoutCodeInput').value = '';
                
            } catch (error) {
                console.error('Error loading layout:', error);
                alert('Error loading layout. Please check your HTML syntax.');
            }
        }

        function clearLayout() {
            currentLayout = null;
            document.getElementById('layoutPreview').innerHTML = `
                <div class="text-center text-gray-500">
                    <div class="text-4xl mb-2">üé®</div>
                    <p>Your imported layout will appear here</p>
                    <p class="text-sm">Upload or paste your HTML to get started</p>
                </div>
            `;
            document.getElementById('layoutStatus').textContent = 'No layout loaded';
            document.getElementById('layoutStatus').className = 'text-sm bg-gray-200 text-gray-700 px-3 py-1 rounded-full';
        }

        // Data sync functions
        function syncDataToLayout() {
            if (!currentLayout) {
                alert('Please load a layout first before syncing data');
                return;
            }

            const preview = document.getElementById('layoutPreview');
            
            // Update sync status
            updateSyncStatus('syncing');
            
            // Simulate API call delay
            setTimeout(() => {
                try {
                    // Find and update elements with data-sync attributes
                    const syncElements = preview.querySelectorAll('[data-sync]');
                    let updatedCount = 0;

                    syncElements.forEach(element => {
                        const syncType = element.getAttribute('data-sync');
                        let newContent = '';

                        switch (syncType) {
                            case 'total-sales':
                                newContent = `$${sampleData.totalSales.toLocaleString()}`;
                                break;
                            case 'avg-ticket':
                                newContent = `$${sampleData.avgTicket}`;
                                break;
                            case 'conversion-rate':
                                newContent = `${sampleData.conversionRate}%`;
                                break;
                            case 'designer-count':
                                newContent = sampleData.designerCount.toString();
                                break;
                            case 'franchise-list':
                                newContent = generateFranchiseTable();
                                break;
                            case 'top-performers':
                                newContent = generateTopPerformers();
                                break;
                            default:
                                console.warn(`Unknown sync type: ${syncType}`);
                                return;
                        }

                        if (newContent) {
                            if (syncType === 'franchise-list' || syncType === 'top-performers') {
                                element.innerHTML = newContent;
                            } else {
                                element.textContent = newContent;
                            }
                            updatedCount++;
                        }
                    });

                    updateSyncStatus('success');
                    document.getElementById('lastSyncTime').textContent = `Last synced: ${new Date().toLocaleTimeString()}`;
                    
                    console.log(`Successfully updated ${updatedCount} elements with fresh data`);
                    
                } catch (error) {
                    console.error('Sync error:', error);
                    updateSyncStatus('error');
                }
            }, 1000);
        }

        function generateFranchiseTable() {
            return sampleData.franchises.map(franchise => `
                <tr>
                    <td>${franchise.name}</td>
                    <td>${franchise.location}</td>
                    <td>$${franchise.sales.toLocaleString()}</td>
                    <td>$${franchise.goal.toLocaleString()}</td>
                    <td>${franchise.performance.toFixed(1)}%</td>
                </tr>
            `).join('');
        }

        function generateTopPerformers() {
            return sampleData.topPerformers.map((performer, index) => `
                <div class="performer-item">
                    <span class="rank">#${index + 1}</span>
                    <span class="name">${performer.name}</span>
                    <span class="franchise">${performer.franchise}</span>
                    <span class="sales">$${performer.sales.toLocaleString()}</span>
                </div>
            `).join('');
        }

        function updateSyncStatus(status) {
            const indicator = document.getElementById('syncIndicator');
            const statusText = document.getElementById('syncStatusText');
            
            switch (status) {
                case 'syncing':
                    indicator.className = 'w-3 h-3 bg-yellow-400 rounded-full mr-2 sync-indicator';
                    statusText.textContent = 'Syncing data...';
                    break;
                case 'success':
                    indicator.className = 'w-3 h-3 bg-green-400 rounded-full mr-2';
                    statusText.textContent = 'Sync successful';
                    break;
                case 'error':
                    indicator.className = 'w-3 h-3 bg-red-400 rounded-full mr-2';
                    statusText.textContent = 'Sync failed';
                    break;
                default:
                    indicator.className = 'w-3 h-3 bg-gray-400 rounded-full mr-2';
                    statusText.textContent = 'Ready to sync';
            }
        }

        function setupAutoSync() {
            const frequency = document.getElementById('syncFrequency').value;
            
            // Clear existing interval
            if (syncInterval) {
                clearInterval(syncInterval);
                syncInterval = null;
                isAutoSyncing = false;
            }
            
            // Set up new interval if not manual
            if (frequency !== 'manual' && currentLayout) {
                const intervalMs = parseInt(frequency) * 1000;
                syncInterval = setInterval(syncDataToLayout, intervalMs);
                isAutoSyncing = true;
                console.log(`Auto-sync enabled: every ${frequency} seconds`);
            }
        }

        // Event listeners
        document.getElementById('uploadLayoutBtn').addEventListener('click', loadLayoutFromFile);
        document.getElementById('pasteLayoutBtn').addEventListener('click', loadLayoutFromCode);
        document.getElementById('clearLayoutBtn').addEventListener('click', clearLayout);
        document.getElementById('syncDataBtn').addEventListener('click', syncDataToLayout);
        document.getElementById('testSyncBtn').addEventListener('click', syncDataToLayout);
        document.getElementById('syncFrequency').addEventListener('change', setupAutoSync);

        // Initialize
        console.log('Layout-Preserving Sync System Ready!');
        console.log('To use your layouts:');
        console.log('1. Add data-sync attributes to elements you want to update');
        console.log('2. Upload or paste your HTML');
        console.log('3. Click "Sync Data Only" to update just the content');
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'985f2da0a4d3247e',t:'MTc1OTAxOTkwOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
