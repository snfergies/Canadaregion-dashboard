<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canada Region</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        .modal {
            backdrop-filter: blur(4px);
        }
        
        .performance-excellent { color: #059669; }
        .performance-good { color: #d97706; }
        .performance-needs-focus { color: #dc2626; }
        
        .trend-up::after {
            content: "↗";
            color: #059669;
            margin-left: 4px;
        }
        
        .trend-down::after {
            content: "↘";
            color: #dc2626;
            margin-left: 4px;
        }
        
        .trend-stable::after {
            content: "→";
            color: #6b7280;
            margin-left: 4px;
        }
        
        @keyframes slideIn {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        .hover-lift:hover {
            transform: translateY(-2px);
            transition: transform 0.2s ease;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-800">Canada Region</h1>
            <p class="text-gray-600 mt-2">Performance tracking and analytics for franchise locations</p>
            
            <!-- Period and View Controls -->
            <div class="flex flex-wrap items-center justify-between mt-6 gap-4">
                <div class="flex items-center space-x-4">
                    <span class="text-sm font-medium text-gray-700">Period:</span>
                    <span id="currentPeriod" class="text-sm text-gray-900 font-medium">September 2025</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <button id="weeklyView" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300">Weekly</button>
                    <button id="monthlyView" class="px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium">Monthly</button>
                    <button id="quarterlyView" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300">Quarterly</button>
                    <button id="ytdView" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300">YTD</button>
                </div>
            </div>
        </div>

        <!-- Key Metrics -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover-lift">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Total Sales</p>
                        <p id="totalSales" class="text-2xl font-bold text-gray-900">$2,847,500</p>
                        <p class="text-sm text-green-600 mt-1">↗ 12.5% vs last month</p>
                    </div>
                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                        <span class="text-green-600 text-xl">💰</span>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover-lift">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Avg Conversion</p>
                        <p id="avgConversion" class="text-2xl font-bold text-gray-900">58.2%</p>
                        <p class="text-sm text-green-600 mt-1">↗ 3.1% vs last month</p>
                    </div>
                    <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                        <span class="text-blue-600 text-xl">📈</span>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover-lift">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Avg Ticket</p>
                        <p id="avgTicket" class="text-2xl font-bold text-gray-900">$1,542</p>
                        <p class="text-sm text-red-600 mt-1">↘ 2.3% vs last month</p>
                    </div>
                    <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                        <span class="text-purple-600 text-xl">🎫</span>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover-lift">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Active Designers</p>
                        <p id="totalDesigners" class="text-2xl font-bold text-gray-900">47</p>
                        <p class="text-sm text-gray-600 mt-1">Across 8 locations</p>
                    </div>
                    <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                        <span class="text-orange-600 text-xl">👥</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Franchise Performance Table -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex flex-wrap items-center justify-between gap-4">
                            <h2 class="text-xl font-semibold text-gray-800">Franchise Performance</h2>
                            <div class="flex flex-wrap gap-2">
                                <button id="manageFranchisesBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium text-sm hover:bg-indigo-700">
                                    Manage Locations
                                </button>
                                <button id="filterDesignersBtn" class="px-4 py-2 bg-gray-600 text-white rounded-lg font-medium text-sm hover:bg-gray-700">
                                    Filter Designers
                                </button>
                                <button id="exportDataBtn" class="px-4 py-2 bg-green-600 text-white rounded-lg font-medium text-sm hover:bg-green-700">
                                    Export Data
                                </button>
                            </div>
                        </div>
                        
                        <!-- Month Selector -->
                        <div class="mt-4 flex items-center space-x-4">
                            <label for="monthSelect" class="text-sm font-medium text-gray-700">Month:</label>
                            <select id="monthSelect" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="2025-01">January 2025</option>
                                <option value="2025-02">February 2025</option>
                                <option value="2025-03">March 2025</option>
                                <option value="2025-04">April 2025</option>
                                <option value="2025-05">May 2025</option>
                                <option value="2025-06">June 2025</option>
                                <option value="2025-07">July 2025</option>
                                <option value="2025-08">August 2025</option>
                                <option value="2025-09" selected>September 2025</option>
                                <option value="2025-10">October 2025</option>
                                <option value="2025-11">November 2025</option>
                                <option value="2025-12">December 2025</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rank</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Franchise</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Monthly Sales</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Goal</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">% of Goal</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Avg Ticket</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Conversion</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Designers</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Top Performer</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Trend</th>
                                </tr>
                            </thead>
                            <tbody id="franchiseTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Table rows will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Top Performers & Designer Rankings -->
            <div class="space-y-6">
                <!-- Top Performers -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-800">Top Performers</h3>
                        <div class="flex flex-wrap gap-2 mt-3">
                            <button id="rankBySales" class="px-4 py-2 bg-green-600 text-white rounded-lg font-medium text-sm">Sales</button>
                            <button id="rankByClosing" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium text-sm hover:bg-gray-300">Closing</button>
                            <button id="rankByTicket" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium text-sm hover:bg-gray-300">Ticket</button>
                        </div>
                    </div>
                    <div id="topPerformersContent" class="p-6">
                        <!-- Top performers will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg shadow-sm text-white p-6">
                    <h3 class="text-lg font-semibold mb-4">Quick Insights</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-indigo-100">Best Location:</span>
                            <span class="font-medium">Downtown Toronto</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-indigo-100">Growth Leader:</span>
                            <span class="font-medium">Mississauga</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-indigo-100">Needs Focus:</span>
                            <span class="font-medium">Hamilton</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-indigo-100">New This Month:</span>
                            <span class="font-medium">3 Designers</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Designer Performance Table -->
        <div class="mt-6">
            <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                <div class="p-6 border-b border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-800">Designer Performance</h2>
                    <p class="text-gray-600 mt-1">Individual designer metrics and performance tracking</p>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rank</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Designer</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Franchise</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Monthly Sales</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Goal</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">% of Goal</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Avg Ticket</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Conversion</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Performance</th>
                            </tr>
                        </thead>
                        <tbody id="designerTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Designer rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Franchise Management Modal -->
    <div id="franchiseManagementModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 modal">
        <div class="bg-white rounded-lg shadow-xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-y-auto slide-in">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-semibold text-gray-800">Manage Franchise Locations</h3>
                    <button id="closeFranchiseManagement" class="text-gray-400 hover:text-gray-600">
                        <span class="text-2xl">&times;</span>
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <!-- Add New Franchise Form -->
                <div class="mb-8 bg-gray-50 rounded-lg p-6">
                    <h4 class="text-lg font-medium text-gray-800 mb-4">Add New Location</h4>
                    <form id="addFranchiseForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Franchise Name</label>
                            <input type="text" id="newFranchiseName" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="e.g., Ottawa Central" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Location</label>
                            <input type="text" id="newFranchiseLocation" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="e.g., Ottawa, ON" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Monthly Goal ($)</label>
                            <input type="number" id="newFranchiseGoal" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="300000" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Number of Designers</label>
                            <input type="number" id="newFranchiseDesigners" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="6" min="1" max="10" required>
                        </div>
                        <div class="md:col-span-2 lg:col-span-4">
                            <button type="submit" class="px-6 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700">
                                Add Location
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Existing Franchises Table -->
                <div>
                    <h4 class="text-lg font-medium text-gray-800 mb-4">Current Locations</h4>
                    <div class="overflow-x-auto">
                        <table class="w-full border border-gray-200 rounded-lg">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Location</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Monthly Sales</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Monthly Goal</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Designers</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Performance</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="franchiseManagementTableBody" class="divide-y divide-gray-200">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Designer Filter Modal -->
    <div id="designerFilterModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 modal">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4 slide-in">
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-xl font-semibold text-gray-800">Filter Designers</h3>
            </div>
            
            <form id="designerFilterForm" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Performance Level</label>
                    <select id="performanceFilter" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="all">All Performance Levels</option>
                        <option value="excellent">Excellent (90%+ of goal)</option>
                        <option value="good">Good (75-89% of goal)</option>
                        <option value="needs-focus">Needs Focus (<75% of goal)</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Franchise Location</label>
                    <select id="franchiseFilter" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="all">All Locations</option>
                        <!-- Populated by JavaScript -->
                    </select>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Min Sales ($)</label>
                        <input type="number" id="minSales" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="0">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Max Sales ($)</label>
                        <input type="number" id="maxSales" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="100000">
                    </div>
                </div>
                
                <div class="flex justify-between pt-4">
                    <button type="button" id="clearFilters" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300">
                        Clear Filters
                    </button>
                    <div class="space-x-2">
                        <button type="button" id="cancelDesignerFilter" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700">
                            Apply Filters
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteConfirmationModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 modal">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4 slide-in">
            <div class="p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Confirm Deletion</h3>
                <p class="text-gray-600 mb-6">
                    Are you sure you want to delete <span id="deleteLocationName" class="font-medium"></span>? 
                    This will permanently remove the location and all associated designer data.
                </p>
                <div class="flex justify-end space-x-3">
                    <button id="cancelDelete" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300">
                        Cancel
                    </button>
                    <button id="confirmDelete" class="px-4 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700">
                        Delete Location
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Drill Down Modal -->
    <div id="drillDownModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 modal">
        <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto slide-in">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-semibold text-gray-800">Performance Details</h3>
                    <button id="closeDrillDown" class="text-gray-400 hover:text-gray-600">
                        <span class="text-2xl">&times;</span>
                    </button>
                </div>
            </div>
            
            <div id="drillDownContent" class="p-6">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentView = 'monthly';
        let currentRankingCriteria = 'sales';
        let currentMonth = '2025-09';
        let franchiseIdCounter = 9;
        let franchiseToDelete = null;
        
        // Designer filters
        let designerFilters = {
            performance: 'all',
            franchise: 'all',
            minSales: null,
            maxSales: null
        };

        // Sample franchise data
        let franchises = [
            {
                id: 1,
                name: 'Downtown Toronto',
                location: 'Toronto, ON',
                monthlySales: 485000,
                monthlyGoal: 450000,
                avgTicket: 1650,
                conversionRate: 62.5,
                designerCount: 8,
                topPerformer: 'Sarah Chen',
                trend: 'up',
                designers: [
                    { name: 'Sarah Chen', sales: 78500, goal: 56250, avgTicket: 1850, conversionRate: 68, experience: '4 years', specialty: 'Modern Design' },
                    { name: 'Michael Rodriguez', sales: 72000, goal: 56250, avgTicket: 1720, conversionRate: 65, experience: '3 years', specialty: 'Contemporary' },
                    { name: 'Emma Thompson', sales: 68500, goal: 56250, avgTicket: 1580, conversionRate: 61, experience: '5 years', specialty: 'Traditional Style' },
                    { name: 'David Kim', sales: 65000, goal: 56250, avgTicket: 1650, conversionRate: 59, experience: '2 years', specialty: 'Luxury Kitchens' },
                    { name: 'Lisa Wang', sales: 62000, goal: 56250, avgTicket: 1600, conversionRate: 63, experience: '3 years', specialty: 'Urban Living' },
                    { name: 'James Wilson', sales: 58000, goal: 56250, avgTicket: 1520, conversionRate: 57, experience: '1 year', specialty: 'Modern Design' },
                    { name: 'Rachel Green', sales: 45000, goal: 56250, avgTicket: 1480, conversionRate: 54, experience: '2 years', specialty: 'Contemporary' },
                    { name: 'Alex Johnson', sales: 36000, goal: 56250, avgTicket: 1420, conversionRate: 52, experience: '1 year', specialty: 'Traditional Style' }
                ]
            },
            {
                id: 2,
                name: 'Mississauga',
                location: 'Mississauga, ON',
                monthlySales: 425000,
                monthlyGoal: 400000,
                avgTicket: 1580,
                conversionRate: 59.8,
                designerCount: 7,
                topPerformer: 'Jennifer Liu',
                trend: 'up',
                designers: [
                    { name: 'Jennifer Liu', sales: 75000, goal: 57143, avgTicket: 1680, conversionRate: 64, experience: '4 years', specialty: 'Luxury Kitchens' },
                    { name: 'Robert Taylor', sales: 68000, goal: 57143, avgTicket: 1620, conversionRate: 61, experience: '3 years', specialty: 'Modern Design' },
                    { name: 'Amanda Foster', sales: 64500, goal: 57143, avgTicket: 1590, conversionRate: 58, experience: '2 years', specialty: 'Contemporary' },
                    { name: 'Kevin Zhang', sales: 61000, goal: 57143, avgTicket: 1550, conversionRate: 60, experience: '5 years', specialty: 'Traditional Style' },
                    { name: 'Michelle Brown', sales: 58500, goal: 57143, avgTicket: 1520, conversionRate: 57, experience: '1 year', specialty: 'Urban Living' },
                    { name: 'Daniel Lee', sales: 52000, goal: 57143, avgTicket: 1480, conversionRate: 55, experience: '2 years', specialty: 'Modern Design' },
                    { name: 'Sophie Martin', sales: 46000, goal: 57143, avgTicket: 1450, conversionRate: 53, experience: '1 year', specialty: 'Contemporary' }
                ]
            },
            {
                id: 3,
                name: 'Vancouver West',
                location: 'Vancouver, BC',
                monthlySales: 398000,
                monthlyGoal: 380000,
                avgTicket: 1620,
                conversionRate: 61.2,
                designerCount: 6,
                topPerformer: 'Ryan Mitchell',
                trend: 'stable',
                designers: [
                    { name: 'Ryan Mitchell', sales: 82000, goal: 63333, avgTicket: 1750, conversionRate: 66, experience: '6 years', specialty: 'Luxury Kitchens' },
                    { name: 'Natalie Cooper', sales: 71500, goal: 63333, avgTicket: 1680, conversionRate: 63, experience: '4 years', specialty: 'Modern Design' },
                    { name: 'Brandon Hall', sales: 68000, goal: 63333, avgTicket: 1620, conversionRate: 60, experience: '3 years', specialty: 'Contemporary' },
                    { name: 'Chloe Adams', sales: 64000, goal: 63333, avgTicket: 1580, conversionRate: 59, experience: '2 years', specialty: 'Traditional Style' },
                    { name: 'Tyler Scott', sales: 58500, goal: 63333, avgTicket: 1540, conversionRate: 58, experience: '3 years', specialty: 'Urban Living' },
                    { name: 'Megan Clark', sales: 54000, goal: 63333, avgTicket: 1500, conversionRate: 56, experience: '1 year', specialty: 'Modern Design' }
                ]
            },
            {
                id: 4,
                name: 'Calgary North',
                location: 'Calgary, AB',
                monthlySales: 365000,
                monthlyGoal: 350000,
                avgTicket: 1480,
                conversionRate: 56.7,
                designerCount: 6,
                topPerformer: 'Jessica Parker',
                trend: 'up',
                designers: [
                    { name: 'Jessica Parker', sales: 72000, goal: 58333, avgTicket: 1580, conversionRate: 60, experience: '5 years', specialty: 'Traditional Style' },
                    { name: 'Matthew Davis', sales: 65500, goal: 58333, avgTicket: 1520, conversionRate: 58, experience: '3 years', specialty: 'Modern Design' },
                    { name: 'Ashley Turner', sales: 62000, goal: 58333, avgTicket: 1480, conversionRate: 56, experience: '2 years', specialty: 'Contemporary' },
                    { name: 'Christopher Lee', sales: 58000, goal: 58333, avgTicket: 1450, conversionRate: 55, experience: '4 years', specialty: 'Luxury Kitchens' },
                    { name: 'Samantha White', sales: 54500, goal: 58333, avgTicket: 1420, conversionRate: 54, experience: '1 year', specialty: 'Urban Living' },
                    { name: 'Jordan Phillips', sales: 53000, goal: 58333, avgTicket: 1400, conversionRate: 53, experience: '2 years', specialty: 'Modern Design' }
                ]
            },
            {
                id: 5,
                name: 'Ottawa Central',
                location: 'Ottawa, ON',
                monthlySales: 342000,
                monthlyGoal: 320000,
                avgTicket: 1520,
                conversionRate: 58.4,
                designerCount: 5,
                topPerformer: 'Lauren Evans',
                trend: 'stable',
                designers: [
                    { name: 'Lauren Evans', sales: 78000, goal: 64000, avgTicket: 1620, conversionRate: 62, experience: '4 years', specialty: 'Luxury Kitchens' },
                    { name: 'Nicholas Young', sales: 71000, goal: 64000, avgTicket: 1580, conversionRate: 60, experience: '3 years', specialty: 'Modern Design' },
                    { name: 'Victoria King', sales: 68500, goal: 64000, avgTicket: 1520, conversionRate: 58, experience: '2 years', specialty: 'Contemporary' },
                    { name: 'Andrew Wright', sales: 65000, goal: 64000, avgTicket: 1480, conversionRate: 57, experience: '5 years', specialty: 'Traditional Style' },
                    { name: 'Stephanie Hill', sales: 59500, goal: 64000, avgTicket: 1450, conversionRate: 55, experience: '1 year', specialty: 'Urban Living' }
                ]
            },
            {
                id: 6,
                name: 'Montreal Downtown',
                location: 'Montreal, QC',
                monthlySales: 318000,
                monthlyGoal: 310000,
                avgTicket: 1450,
                conversionRate: 55.9,
                designerCount: 5,
                topPerformer: 'Marie Dubois',
                trend: 'stable',
                designers: [
                    { name: 'Marie Dubois', sales: 72000, goal: 62000, avgTicket: 1520, conversionRate: 59, experience: '6 years', specialty: 'Traditional Style' },
                    { name: 'Jean-Luc Martin', sales: 68500, goal: 62000, avgTicket: 1480, conversionRate: 57, experience: '4 years', specialty: 'Modern Design' },
                    { name: 'Isabelle Roy', sales: 65000, goal: 62000, avgTicket: 1450, conversionRate: 56, experience: '3 years', specialty: 'Contemporary' },
                    { name: 'Pierre Gagnon', sales: 58000, goal: 62000, avgTicket: 1420, conversionRate: 54, experience: '2 years', specialty: 'Luxury Kitchens' },
                    { name: 'Sylvie Tremblay', sales: 54500, goal: 62000, avgTicket: 1380, conversionRate: 53, experience: '1 year', specialty: 'Urban Living' }
                ]
            },
            {
                id: 7,
                name: 'Edmonton South',
                location: 'Edmonton, AB',
                monthlySales: 285000,
                monthlyGoal: 290000,
                avgTicket: 1380,
                conversionRate: 53.2,
                designerCount: 4,
                topPerformer: 'Connor Murphy',
                trend: 'down',
                designers: [
                    { name: 'Connor Murphy', sales: 78000, goal: 72500, avgTicket: 1450, conversionRate: 56, experience: '5 years', specialty: 'Modern Design' },
                    { name: 'Hannah Stewart', sales: 72000, goal: 72500, avgTicket: 1380, conversionRate: 53, experience: '3 years', specialty: 'Contemporary' },
                    { name: 'Ethan Campbell', sales: 68500, goal: 72500, avgTicket: 1350, conversionRate: 52, experience: '2 years', specialty: 'Traditional Style' },
                    { name: 'Olivia Bennett', sales: 66500, goal: 72500, avgTicket: 1320, conversionRate: 51, experience: '1 year', specialty: 'Urban Living' }
                ]
            },
            {
                id: 8,
                name: 'Hamilton',
                location: 'Hamilton, ON',
                monthlySales: 229500,
                monthlyGoal: 280000,
                avgTicket: 1320,
                conversionRate: 49.8,
                designerCount: 4,
                topPerformer: 'Grace Collins',
                trend: 'down',
                designers: [
                    { name: 'Grace Collins', sales: 68000, goal: 70000, avgTicket: 1380, conversionRate: 52, experience: '4 years', specialty: 'Traditional Style' },
                    { name: 'Lucas Reed', sales: 58500, goal: 70000, avgTicket: 1320, conversionRate: 50, experience: '2 years', specialty: 'Modern Design' },
                    { name: 'Zoe Morgan', sales: 52000, goal: 70000, avgTicket: 1280, conversionRate: 48, experience: '3 years', specialty: 'Contemporary' },
                    { name: 'Ian Cooper', sales: 51000, goal: 70000, avgTicket: 1260, conversionRate: 47, experience: '1 year', specialty: 'Urban Living' }
                ]
            }
        ];

        // Initialize dashboard
        function initDashboard() {
            updateDesignerMetrics();
            renderFranchiseTable();
            renderDesignerTable();
            renderTopPerformers();
            setupEventListeners();
            updateFranchiseFilterOptions();
        }

        // Update designer metrics
        function updateDesignerMetrics() {
            const totalSales = franchises.reduce((sum, f) => sum + f.monthlySales, 0);
            const totalDesigners = franchises.reduce((sum, f) => sum + f.designerCount, 0);
            const avgConversion = franchises.reduce((sum, f) => sum + (f.conversionRate * f.designerCount), 0) / totalDesigners;
            const avgTicket = franchises.reduce((sum, f) => sum + (f.avgTicket * f.designerCount), 0) / totalDesigners;

            document.getElementById('totalSales').textContent = `$${totalSales.toLocaleString()}`;
            document.getElementById('totalDesigners').textContent = totalDesigners;
            document.getElementById('avgConversion').textContent = `${avgConversion.toFixed(1)}%`;
            document.getElementById('avgTicket').textContent = `$${Math.round(avgTicket)}`;
        }

        // Render franchise table
        function renderFranchiseTable() {
            const tbody = document.getElementById('franchiseTableBody');
            tbody.innerHTML = '';

            // Sort franchises by monthly sales (descending)
            const sortedFranchises = [...franchises].sort((a, b) => b.monthlySales - a.monthlySales);

            sortedFranchises.forEach((franchise, index) => {
                const goalPercentage = ((franchise.monthlySales / franchise.monthlyGoal) * 100).toFixed(1);
                const performanceColor = goalPercentage >= 90 ? 'text-green-600' : goalPercentage >= 75 ? 'text-yellow-600' : 'text-red-600';
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 cursor-pointer';
                row.onclick = () => showFranchiseDetail(franchise.id);
                
                row.innerHTML = `
                    <td class="px-4 py-4 text-sm font-medium text-gray-900">${index + 1}</td>
                    <td class="px-4 py-4">
                        <div class="text-sm font-medium text-gray-900">${franchise.name}</div>
                        <div class="text-sm text-gray-500">${franchise.location}</div>
                    </td>
                    <td class="px-4 py-4 text-sm text-gray-900">$${franchise.monthlySales.toLocaleString()}</td>
                    <td class="px-4 py-4 text-sm text-gray-900">$${franchise.monthlyGoal.toLocaleString()}</td>
                    <td class="px-4 py-4 text-sm font-medium ${performanceColor}">${goalPercentage}%</td>
                    <td class="px-4 py-4 text-sm text-gray-900">$${franchise.avgTicket}</td>
                    <td class="px-4 py-4 text-sm text-gray-900">${franchise.conversionRate}%</td>
                    <td class="px-4 py-4 text-sm text-gray-900">${franchise.designerCount}</td>
                    <td class="px-4 py-4 text-sm text-gray-900">${franchise.topPerformer}</td>
                    <td class="px-4 py-4 text-sm text-gray-900">
                        <span class="trend-${franchise.trend}">${franchise.trend}</span>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Get all designers with franchise info
        function getAllDesigners() {
            const allDesigners = [];
            franchises.forEach(franchise => {
                franchise.designers.forEach(designer => {
                    allDesigners.push({
                        ...designer,
                        franchiseName: franchise.name,
                        franchiseId: franchise.id,
                        designerId: `${franchise.id}-${designer.name}`
                    });
                });
            });
            return allDesigners;
        }

        // Apply designer filters
        function applyDesignerFilters(designers) {
            return designers.filter(designer => {
                // Performance filter
                if (designerFilters.performance !== 'all') {
                    const goalPercentage = (designer.sales / designer.goal) * 100;
                    if (designerFilters.performance === 'excellent' && goalPercentage < 90) return false;
                    if (designerFilters.performance === 'good' && (goalPercentage < 75 || goalPercentage >= 90)) return false;
                    if (designerFilters.performance === 'needs-focus' && goalPercentage >= 75) return false;
                }

                // Franchise filter
                if (designerFilters.franchise !== 'all' && designer.franchiseName !== designerFilters.franchise) {
                    return false;
                }

                // Sales range filter
                if (designerFilters.minSales !== null && designer.sales < designerFilters.minSales) return false;
                if (designerFilters.maxSales !== null && designer.sales > designerFilters.maxSales) return false;

                return true;
            });
        }

        // Sort designers by current ranking criteria
        function sortDesignersByRanking(designers) {
            switch (currentRankingCriteria) {
                case 'sales':
                    return designers.sort((a, b) => b.sales - a.sales);
                case 'closing':
                    return designers.sort((a, b) => b.conversionRate - a.conversionRate);
                case 'ticket':
                    return designers.sort((a, b) => b.avgTicket - a.avgTicket);
                default:
                    return designers.sort((a, b) => b.sales - a.sales);
            }
        }

        // Render designer table
        function renderDesignerTable() {
            const tbody = document.getElementById('designerTableBody');
            tbody.innerHTML = '';

            let allDesigners = getAllDesigners();
            allDesigners = applyDesignerFilters(allDesigners);
            allDesigners = sortDesignersByRanking(allDesigners);

            allDesigners.forEach((designer, index) => {
                const goalPercentage = ((designer.sales / designer.goal) * 100).toFixed(1);
                const performanceColor = goalPercentage >= 90 ? 'text-green-600' : goalPercentage >= 75 ? 'text-yellow-600' : 'text-red-600';
                const performanceIcon = goalPercentage >= 90 ? '🏆' : goalPercentage >= 75 ? '👍' : '📈';
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 cursor-pointer';
                row.onclick = () => showDesignerDetail(designer.designerId);
                
                row.innerHTML = `
                    <td class="px-4 py-4 text-sm font-medium text-gray-900">${index + 1}</td>
                    <td class="px-4 py-4">
                        <div class="text-sm font-medium text-gray-900">${designer.name}</div>
                        <div class="text-sm text-gray-500">${designer.experience} • ${designer.specialty}</div>
                    </td>
                    <td class="px-4 py-4 text-sm text-gray-900">${designer.franchiseName}</td>
                    <td class="px-4 py-4 text-sm text-gray-900">$${designer.sales.toLocaleString()}</td>
                    <td class="px-4 py-4 text-sm text-gray-900">$${designer.goal.toLocaleString()}</td>
                    <td class="px-4 py-4 text-sm font-medium ${performanceColor}">${goalPercentage}%</td>
                    <td class="px-4 py-4 text-sm text-gray-900">$${designer.avgTicket}</td>
                    <td class="px-4 py-4 text-sm text-gray-900">${designer.conversionRate}%</td>
                    <td class="px-4 py-4 text-center text-lg">${performanceIcon}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Render top performers
        function renderTopPerformers() {
            const content = document.getElementById('topPerformersContent');
            
            let allDesigners = getAllDesigners();
            allDesigners = sortDesignersByRanking(allDesigners);
            const topDesigners = allDesigners.slice(0, 5);

            const criteriaLabels = {
                sales: 'Sales',
                closing: 'Conversion Rate',
                ticket: 'Avg Ticket'
            };

            const criteriaValues = {
                sales: (d) => `$${d.sales.toLocaleString()}`,
                closing: (d) => `${d.conversionRate}%`,
                ticket: (d) => `$${d.avgTicket}`
            };

            content.innerHTML = `
                <div class="space-y-4">
                    ${topDesigners.map((designer, index) => `
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer" onclick="showDesignerDetail('${designer.designerId}')">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center">
                                    <span class="text-indigo-600 font-bold text-sm">${index + 1}</span>
                                </div>
                                <div>
                                    <div class="font-medium text-gray-900">${designer.name}</div>
                                    <div class="text-sm text-gray-500">${designer.franchiseName}</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="font-medium text-gray-900">${criteriaValues[currentRankingCriteria](designer)}</div>
                                <div class="text-sm text-gray-500">${criteriaLabels[currentRankingCriteria]}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Show franchise detail
        function showFranchiseDetail(franchiseId) {
            const franchise = franchises.find(f => f.id === franchiseId);
            if (!franchise) return;

            const content = document.getElementById('drillDownContent');
            const goalPercentage = ((franchise.monthlySales / franchise.monthlyGoal) * 100).toFixed(1);
            
            content.innerHTML = `
                <div class="mb-6">
                    <h4 class="text-xl font-bold text-gray-800">${franchise.name}</h4>
                    <p class="text-gray-600">${franchise.location} • ${franchise.designerCount} Designers</p>
                </div>

                <!-- Franchise Performance Overview -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h5 class="font-semibold text-blue-800">Monthly Sales</h5>
                        <p class="text-xl font-bold text-blue-600">$${franchise.monthlySales.toLocaleString()}</p>
                        <p class="text-sm text-blue-600">${goalPercentage}% of goal</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h5 class="font-semibold text-green-800">Conversion Rate</h5>
                        <p class="text-xl font-bold text-green-600">${franchise.conversionRate}%</p>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg">
                        <h5 class="font-semibold text-purple-800">Avg Ticket</h5>
                        <p class="text-xl font-bold text-purple-600">$${franchise.avgTicket}</p>
                    </div>
                    <div class="bg-orange-50 p-4 rounded-lg">
                        <h5 class="font-semibold text-orange-800">Goal Progress</h5>
                        <p class="text-xl font-bold text-orange-600">$${franchise.monthlyGoal.toLocaleString()}</p>
                        <div class="w-full bg-orange-200 rounded-full h-2 mt-1">
                            <div class="bg-orange-600 h-2 rounded-full" style="width: ${Math.min(goalPercentage, 100)}%"></div>
                        </div>
                    </div>
                </div>

                <!-- Designer Performance Table -->
                <div class="bg-white rounded-lg border border-gray-200">
                    <div class="p-4 border-b border-gray-200">
                        <h5 class="font-semibold text-gray-800">Designer Performance</h5>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Designer</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Sales</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Goal</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">% of Goal</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Avg Ticket</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Conversion</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Performance</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                ${franchise.designers.sort((a, b) => b.sales - a.sales).map(designer => {
                                    const designerGoalPercentage = ((designer.sales / designer.goal) * 100).toFixed(1);
                                    const rateColor = designerGoalPercentage >= 90 ? 'text-green-600' : designerGoalPercentage >= 75 ? 'text-yellow-600' : 'text-red-600';
                                    const performanceIcon = designerGoalPercentage >= 90 ? '🏆' : designerGoalPercentage >= 75 ? '👍' : '📈';
                                    
                                    return `
                                        <tr class="hover:bg-gray-50 cursor-pointer" onclick="showDesignerDetail('${franchise.id}-${designer.name}')">
                                            <td class="px-4 py-2">
                                                <div class="font-medium text-gray-900">${designer.name}</div>
                                                <div class="text-sm text-gray-500">${designer.specialty}</div>
                                            </td>
                                            <td class="px-4 py-2 text-gray-900">$${designer.sales.toLocaleString()}</td>
                                            <td class="px-4 py-2 text-gray-900">$${designer.goal.toLocaleString()}</td>
                                            <td class="px-4 py-2 ${rateColor} font-medium">${designerGoalPercentage}%</td>
                                            <td class="px-4 py-2 text-gray-900">$${designer.avgTicket}</td>
                                            <td class="px-4 py-2 ${rateColor} font-medium">${designer.conversionRate}%</td>
                                            <td class="px-4 py-2 text-center text-lg">${performanceIcon}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            showModal('drillDownModal');
        }

        // Setup event listeners
        function setupEventListeners() {
            // View toggles
            document.getElementById('weeklyView').addEventListener('click', () => switchView('weekly'));
            document.getElementById('monthlyView').addEventListener('click', () => switchView('monthly'));
            document.getElementById('quarterlyView').addEventListener('click', () => switchView('quarterly'));
            document.getElementById('ytdView').addEventListener('click', () => switchView('ytd'));

            // Ranking criteria toggles
            document.getElementById('rankBySales').addEventListener('click', () => switchRankingCriteria('sales'));
            document.getElementById('rankByClosing').addEventListener('click', () => switchRankingCriteria('closing'));
            document.getElementById('rankByTicket').addEventListener('click', () => switchRankingCriteria('ticket'));

            // Modal triggers
            document.getElementById('manageFranchisesBtn').addEventListener('click', () => {
                renderFranchiseManagementTable();
                showModal('franchiseManagementModal');
            });
            document.getElementById('filterDesignersBtn').addEventListener('click', showDesignerFilterModal);
            document.getElementById('exportDataBtn').addEventListener('click', exportData);

            // Modal cancels and closes
            document.getElementById('closeFranchiseManagement').addEventListener('click', () => hideModal('franchiseManagementModal'));
            document.getElementById('cancelDesignerFilter').addEventListener('click', () => hideModal('designerFilterModal'));
            document.getElementById('closeDrillDown').addEventListener('click', () => hideModal('drillDownModal'));
            document.getElementById('cancelDelete').addEventListener('click', () => hideModal('deleteConfirmationModal'));
            document.getElementById('confirmDelete').addEventListener('click', deleteFranchise);

            // Form submissions
            document.getElementById('addFranchiseForm').addEventListener('submit', addFranchise);
            document.getElementById('designerFilterForm').addEventListener('submit', handleDesignerFilter);
            document.getElementById('clearFilters').addEventListener('click', clearDesignerFilters);

            // Month selector
            document.getElementById('monthSelect').addEventListener('change', (e) => {
                currentMonth = e.target.value;
                renderDesignerTable();
            });
        }

        // Render franchise management table
        function renderFranchiseManagementTable() {
            const tbody = document.getElementById('franchiseManagementTableBody');
            tbody.innerHTML = '';

            franchises.forEach(franchise => {
                const goalPercentage = ((franchise.monthlySales / franchise.monthlyGoal) * 100).toFixed(1);
                const performanceColor = goalPercentage >= 90 ? 'text-green-600' : goalPercentage >= 75 ? 'text-yellow-600' : 'text-red-600';
                const performanceText = goalPercentage >= 90 ? 'Excellent' : goalPercentage >= 75 ? 'Good' : 'Needs Focus';

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-3 font-medium text-gray-900">${franchise.name}</td>
                    <td class="px-4 py-3 text-gray-900">${franchise.location}</td>
                    <td class="px-4 py-3 text-gray-900">$${franchise.monthlySales.toLocaleString()}</td>
                    <td class="px-4 py-3 text-gray-900">$${franchise.monthlyGoal.toLocaleString()}</td>
                    <td class="px-4 py-3 text-gray-900">${franchise.designerCount}</td>
                    <td class="px-4 py-3 ${performanceColor} font-medium">${performanceText} (${goalPercentage}%)</td>
                    <td class="px-4 py-3">
                        <button class="delete-franchise-btn text-red-600 hover:text-red-800 font-medium" data-franchise-id="${franchise.id}">
                            Delete
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // Add delete event listeners
            document.querySelectorAll('.delete-franchise-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const franchiseId = parseInt(e.target.dataset.franchiseId);
                    const franchise = franchises.find(f => f.id === franchiseId);
                    if (franchise) {
                        franchiseToDelete = franchiseId;
                        document.getElementById('deleteLocationName').textContent = franchise.name;
                        showModal('deleteConfirmationModal');
                    }
                });
            });
        }

        // Add new franchise
        function addFranchise(e) {
            e.preventDefault();
            
            const name = document.getElementById('newFranchiseName').value.trim();
            const location = document.getElementById('newFranchiseLocation').value.trim();
            const goal = parseInt(document.getElementById('newFranchiseGoal').value);
            const designerCount = parseInt(document.getElementById('newFranchiseDesigners').value);

            if (!name || !location || !goal || !designerCount) {
                alert('Please fill in all fields');
                return;
            }

            // Generate sample designers for the new franchise
            const sampleDesignerNames = [
                'Alex Johnson', 'Sarah Williams', 'Michael Brown', 'Jessica Davis', 'David Wilson',
                'Emily Taylor', 'Christopher Moore', 'Amanda Anderson', 'Ryan Thomas', 'Lauren Jackson'
            ];

            const designers = [];
            for (let i = 0; i < designerCount; i++) {
                const designerName = sampleDesignerNames[i] || `Designer ${i + 1}`;
                const individualGoal = Math.round(goal / designerCount);
                const salesVariation = 0.6 + (Math.random() * 0.8); // 60% to 140% of goal
                const sales = Math.round(individualGoal * salesVariation);
                
                designers.push({
                    name: designerName,
                    sales: sales,
                    goal: individualGoal,
                    avgTicket: 1200 + Math.round(Math.random() * 800), // $1200-$2000
                    conversionRate: Math.round(40 + Math.random() * 35), // 40-75%
                    experience: Math.random() > 0.5 ? `${Math.ceil(Math.random() * 6)} years` : '1 year',
                    specialty: ['Modern Design', 'Traditional Style', 'Contemporary', 'Luxury Kitchens', 'Urban Living'][Math.floor(Math.random() * 5)]
                });
            }

            const totalSales = designers.reduce((sum, d) => sum + d.sales, 0);
            const avgTicket = Math.round(designers.reduce((sum, d) => sum + d.avgTicket, 0) / designers.length);
            const avgConversion = Math.round(designers.reduce((sum, d) => sum + d.conversionRate, 0) / designers.length * 10) / 10;

            const newFranchise = {
                id: franchiseIdCounter++,
                name: name,
                location: location,
                monthlySales: totalSales,
                monthlyGoal: goal,
                avgTicket: avgTicket,
                conversionRate: avgConversion,
                designerCount: designerCount,
                topPerformer: designers.sort((a, b) => b.sales - a.sales)[0].name,
                trend: 'stable',
                designers: designers
            };

            franchises.push(newFranchise);
            
            // Update dashboard
            updateDesignerMetrics();
            renderDesignerTable();
            renderTopPerformers();
            renderFranchiseManagementTable();
            updateFranchiseFilterOptions();

            // Clear form
            document.getElementById('addFranchiseForm').reset();
            
            alert(`Successfully added ${name}! The location has been added with ${designerCount} sample designers.`);
        }

        // Delete franchise
        function deleteFranchise() {
            if (franchiseToDelete === null) return;

            const franchiseIndex = franchises.findIndex(f => f.id === franchiseToDelete);
            if (franchiseIndex === -1) return;

            const deletedFranchise = franchises[franchiseIndex];
            franchises.splice(franchiseIndex, 1);

            // Update dashboard
            updateDesignerMetrics();
            renderDesignerTable();
            renderTopPerformers();
            renderFranchiseManagementTable();
            updateFranchiseFilterOptions();

            hideModal('deleteConfirmationModal');
            franchiseToDelete = null;

            alert(`Successfully deleted ${deletedFranchise.name} and all associated data.`);
        }

        // Update franchise filter options
        function updateFranchiseFilterOptions() {
            const franchiseFilter = document.getElementById('franchiseFilter');
            const currentValue = franchiseFilter.value;
            
            // Clear existing options except "All Locations"
            franchiseFilter.innerHTML = '<option value="all">All Locations</option>';
            
            // Add current franchises
            franchises.forEach(franchise => {
                const option = document.createElement('option');
                option.value = franchise.name;
                option.textContent = franchise.name;
                franchiseFilter.appendChild(option);
            });
            
            // Restore previous selection if it still exists
            if (currentValue !== 'all' && franchises.some(f => f.name === currentValue)) {
                franchiseFilter.value = currentValue;
            }
        }

        // Show designer filter modal
        function showDesignerFilterModal() {
            showModal('designerFilterModal');
        }

        // Handle designer filter
        function handleDesignerFilter(e) {
            e.preventDefault();
            designerFilters.performance = document.getElementById('performanceFilter').value;
            designerFilters.franchise = document.getElementById('franchiseFilter').value;
            designerFilters.minSales = document.getElementById('minSales').value ? parseInt(document.getElementById('minSales').value) : null;
            designerFilters.maxSales = document.getElementById('maxSales').value ? parseInt(document.getElementById('maxSales').value) : null;
            
            renderDesignerTable();
            hideModal('designerFilterModal');
        }

        // Clear designer filters
        function clearDesignerFilters() {
            designerFilters = {
                performance: 'all',
                franchise: 'all',
                minSales: null,
                maxSales: null
            };

            document.getElementById('performanceFilter').value = 'all';
            document.getElementById('franchiseFilter').value = 'all';
            document.getElementById('minSales').value = '';
            document.getElementById('maxSales').value = '';
            
            renderDesignerTable();
        }

        // Show designer detail
        function showDesignerDetail(designerId) {
            const [franchiseId, designerName] = designerId.split('-');
            const franchise = franchises.find(f => f.id === parseInt(franchiseId));
            const designer = franchise?.designers.find(d => d.name === designerName);
            
            if (!designer) return;

            const content = document.getElementById('drillDownContent');
            const goalPercentage = ((designer.sales / designer.goal) * 100).toFixed(1);
            
            content.innerHTML = `
                <div class="mb-6">
                    <h4 class="text-xl font-bold text-gray-800">${designer.name}</h4>
                    <p class="text-gray-600">${franchise.name} • ${designer.experience} • ${designer.specialty}</p>
                </div>

                <!-- Designer Performance Overview -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h5 class="font-semibold text-blue-800">Monthly Sales</h5>
                        <p class="text-xl font-bold text-blue-600">$${designer.sales.toLocaleString()}</p>
                        <p class="text-sm text-blue-600">${goalPercentage}% of goal</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h5 class="font-semibold text-green-800">Conversion Rate</h5>
                        <p class="text-xl font-bold text-green-600">${designer.conversionRate}%</p>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg">
                        <h5 class="font-semibold text-purple-800">Avg Ticket</h5>
                        <p class="text-xl font-bold text-purple-600">$${designer.avgTicket}</p>
                    </div>
                    <div class="bg-orange-50 p-4 rounded-lg">
                        <h5 class="font-semibold text-orange-800">Goal Progress</h5>
                        <p class="text-xl font-bold text-orange-600">$${designer.goal.toLocaleString()}</p>
                        <div class="w-full bg-orange-200 rounded-full h-2 mt-1">
                            <div class="bg-orange-600 h-2 rounded-full" style="width: ${Math.min(goalPercentage, 100)}%"></div>
                        </div>
                    </div>
                </div>

                <!-- Development Recommendations -->
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6">
                    <h5 class="font-semibold text-gray-800 mb-4">Development Recommendations</h5>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h6 class="font-medium text-gray-700 mb-2">Strengths</h6>
                            <ul class="text-sm text-gray-600 space-y-1">
                                ${goalPercentage >= 90 ? '<li>• Consistently exceeding sales goals</li>' : ''}
                                ${designer.conversionRate >= 60 ? '<li>• Strong conversion rate performance</li>' : ''}
                                ${designer.avgTicket >= 1500 ? '<li>• High average ticket value</li>' : ''}
                                <li>• Specialized in ${designer.specialty}</li>
                            </ul>
                        </div>
                        <div>
                            <h6 class="font-medium text-gray-700 mb-2">Growth Opportunities</h6>
                            <ul class="text-sm text-gray-600 space-y-1">
                                ${goalPercentage < 80 ? '<li>• Focus on goal achievement strategies</li>' : ''}
                                ${designer.conversionRate < 55 ? '<li>• Improve consultation and closing skills</li>' : ''}
                                ${designer.avgTicket < 1400 ? '<li>• Upselling and add-on training</li>' : ''}
                                ${designer.experience.includes('1 year') ? '<li>• Mentorship with senior designers</li>' : ''}
                            </ul>
                        </div>
                    </div>
                </div>
            `;

            showModal('drillDownModal');
        }

        // Switch view
        function switchView(view) {
            currentView = view;
            
            // Update button styles
            document.querySelectorAll('[id$="View"]').forEach(btn => {
                btn.className = 'px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300';
            });
            document.getElementById(view + 'View').className = 'px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium';

            // Update period display
            const periods = {
                weekly: 'Week of September 2-8, 2025',
                monthly: 'September 2025',
                quarterly: 'Q3 2025',
                ytd: 'January - September 2025'
            };

            document.getElementById('currentPeriod').textContent = periods[view];
        }

        // Switch ranking criteria
        function switchRankingCriteria(criteria) {
            currentRankingCriteria = criteria;
            
            // Update button styles
            document.getElementById('rankBySales').className = 'px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium text-sm hover:bg-gray-300';
            document.getElementById('rankByClosing').className = 'px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium text-sm hover:bg-gray-300';
            document.getElementById('rankByTicket').className = 'px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium text-sm hover:bg-gray-300';
            
            const colors = {
                sales: 'bg-green-600',
                closing: 'bg-blue-600',
                ticket: 'bg-purple-600'
            };
            
            document.getElementById(`rankBy${criteria.charAt(0).toUpperCase() + criteria.slice(1)}`).className = 
                `px-4 py-2 ${colors[criteria]} text-white rounded-lg font-medium text-sm`;

            // Re-render table and top performers with new ranking
            renderDesignerTable();
            renderTopPerformers();
        }

        // Modal functions
        function showModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
            document.getElementById(modalId).classList.add('flex');
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            document.getElementById(modalId).classList.remove('flex');
        }



        // Export data function
        function exportData() {
            const csvContent = "data:text/csv;charset=utf-8," 
                + "Rank,Franchise,Location,Monthly Sales,Monthly Goal,% of Goal,Avg Ticket,Conversion Rate,Designers,Top Performer\n"
                + franchises.map((f, i) => {
                    const rank = [...franchises].sort((a, b) => b.monthlySales - a.monthlySales).findIndex(franchise => franchise.id === f.id) + 1;
                    const goalPercentage = ((f.monthlySales / f.monthlyGoal) * 100).toFixed(1);
                    return `${rank},"${f.name}","${f.location}",${f.monthlySales},${f.monthlyGoal},${goalPercentage}%,${f.avgTicket},${f.conversionRate}%,${f.designerCount},"${f.topPerformer}"`;
                }).join("\n");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `regional_performance_${currentMonth}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Initialize dashboard on page load
        initDashboard();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'985eacb927d0cc62',t:'MTc1OTAxNDYyOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'985f835781fd422b',t:'MTc1OTAyMzQyMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
